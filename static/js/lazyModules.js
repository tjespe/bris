app.controller("weatherCtrl",['$http','$scope','$window','$location',function($http,$scope,$window,$location){let vm=this;$scope.master.data=[];vm.timezone=-(new Date().getTimezoneOffset()/60);vm.rawdata=[];for(var index in $scope.master.recents){if($scope.master.recents.hasOwnProperty(index)){if(Date.now()-$scope.master.recents[index].info.savedAt>1800000&&navigator.onLine){delete $scope.master.recents[index]}}}
if($scope.master.recents.hasOwnProperty($location.path())){$scope.master.location=$scope.master.recents[$location.path()].info.location;$scope.master.data=$scope.master.recents[$location.path()].data}else{if((typeof(Storage)==="undefined"||(typeof(Storage)!=="undefined"&&localStorage.hideFlipDeviceTip!="true"))&&window.innerWidth<=515){$scope.master.hideFlipDeviceTip=!1}
if($location.path().length>3){fetchUsingPlaceName()}else{if(navigator.geolocation){console.log("Trying to fetch position");navigator.geolocation.getCurrentPosition(fetchUsingPosition,fetchUsingApproxPosition)}else{fetchUsingApproxPosition()}}
function fetchUsingPlaceName(){alert("Fetching using place name is not implemented yet!")}
function fetchUsingPosition(position){console.log("Position accessed successfully",position);$scope.master.location=$scope.master.textData.yourExactPosition;let url='https://real-timer-server.tk:2087/get-weather.php?lat='+position.coords.latitude+'&long='+position.coords.longitude+'&gmt='+vm.timezone+'&d='+Math.round(Date.now()/(1000*60*30));$http.get(url).success(function(data){Array.prototype.push.apply(vm.rawdata,data.data);processData()}).error(function(data,status){fetchUsingApproxPosition()})}
function fetchUsingApproxPosition(){alert("Fetching using approximate is not implemented yet!")}}
angular.element($window).on('resize',function(){$scope.$apply(function(){$scope.master.height=window.innerHeight;$scope.master.width=window.innerWidth;if($scope.master.width>515){$scope.master.hideFlipDeviceTip=!0;if(typeof(Storage)!=="undefined"){localStorage.hideFlipDeviceTip=!0}}})});function processData(){let semi_processed_data=[];let imgs_path="/static/img/modern-icons/";for(let i=0;i<vm.rawdata.length;i++){let icon=vm.rawdata[i].icon;vm.rawdata[i].offset=!1;vm.rawdata[i].showImg=!0;if(/^[\d]+$/.test(icon)){vm.rawdata[i].background="";vm.rawdata[i].foreground=imgs_path+icon+".png"}else if(/^\d+d$/.test(icon)){if(icon=="01d"){vm.rawdata[i].background="";vm.rawdata[i].foreground=imgs_path+"01db.png"}else if(icon=="02d"){vm.rawdata[i].background=imgs_path+"01db.png";vm.rawdata[i].foreground=imgs_path+"02f.png"}else{vm.rawdata[i].background=imgs_path+"db.png";vm.rawdata[i].foreground=imgs_path+icon.substring(0,2)+"f.png"}}else if(/^\d+m$/.test(icon)){if(icon=="01m"){vm.rawdata[i].background=imgs_path+"01mb.png"}else{vm.rawdata[i].background=imgs_path+"mb.png"}
vm.rawdata[i].foreground=imgs_path+icon.substring(0,2)+"f.png"}else if(/^mf\/\d+n\.\d+$/.test(icon)){var phase=icon.substring(7,9);if(!/^mf\/0[12]n\.\d{2}$/.test(icon)){vm.rawdata[i].offset=!0}
vm.rawdata[i].phase=findPhase(phase);if(icon.substring(3,5)==="01"){vm.rawdata[i].showImg=!1}else{vm.rawdata[i].foreground=imgs_path+icon.substring(3,5)+"f.png"}}
let date=Number(vm.rawdata[i].date);if(typeof semi_processed_data[date]==="undefined")semi_processed_data[date]=[];semi_processed_data[date].push(vm.rawdata[i])}
let processed_data=[];let date=new Date().getUTCDate();let days_this_month=new Date(new Date().getFullYear(),new Date().getUTCMonth(),0).getDate();for(let _i_=date;_i_<date+days_this_month;_i_++){let i=_i_>days_this_month?_i_-days_this_month:_i_;if(typeof semi_processed_data[i]!=="undefined"){let obj={"data":[]};let weekday_num;if(semi_processed_data[i].length>4){for(let j=0;j<semi_processed_data[i].length;j++){let hour=Number(semi_processed_data[i][j].hour);let period=hour<6?0:hour<12?1:hour<18?2:3;if(typeof obj.data[period]==="undefined")obj.data[period]={"data":[]};obj.data[period].data.push(semi_processed_data[i][j])}
obj.data.clean();for(let period=0;period<obj.data.length;period++){let first_child=obj.data[period].data[0];let last_child=obj.data[period].data.slice(-1)[0];obj.data[period].hour=first_child.hour;obj.data[period].hourTo=last_child.hour;obj.data[period].background=first_child.background;obj.data[period].foreground=first_child.foreground;obj.data[period].icon=first_child.icon;obj.data[period].offset=first_child.offset;obj.data[period].phase=first_child.phase;obj.data[period].summarizeable=!0;obj.data[period].currently_summarized=!0;let temperature_sum=0;let precipitation_sum=0;let wind_sum=0;for(var j=0;j<obj.data[period].data.length;j++){temperature_sum+=Number(obj.data[period].data[j].degs);precipitation_sum+=Number(obj.data[period].data[j].precipitation);wind_sum+=Number(obj.data[period].data[j].wind)}
obj.data[period].degs=Math.round(temperature_sum/obj.data[period].data.length);obj.data[period].precipitation=Math.round(precipitation_sum*100)/100;obj.data[period].wind=Math.round(wind_sum/obj.data[period].data.length)}
weekday_num=new Date(obj.data[0].data[0].unix*1000).getDay();obj.day=$scope.master.textData.weekdays[weekday_num>0?weekday_num-1:6]}else{obj.data=semi_processed_data[i];for(let period=0;period<obj.data.length;period++){obj.data[period].data=[];obj.data[period].summarizeable=!1;obj.data[period].currently_summarized=!0};weekday_num=new Date(obj.data[0].unix*1000).getDay()}
obj.day=$scope.master.textData.weekdays[weekday_num>0?weekday_num-1:6];processed_data.push(obj)}}
$scope.master.data=processed_data;$scope.master.recents[$location.path()]={data:processed_data,info:{url:$location.path(),location:$scope.master.location,savedAt:Date.now()}}
if(typeof(Storage)!=="undefined"){localStorage.recents=JSON.stringify($scope.master.recents)}};function compare(a,b){if(a.data[0].hour<b.data[0].hour)
return-1;if(a.data[0].hour>b.data[0].hour)
return 1;return 0}
function findPhase(x){if(x<=50)return(-x)*0.5;return 25-(x-50)*0.5}
if(typeof(Storage)!=="undefined"){let visits=localStorage.visits||0;localStorage.visits=Number(visits)+1}
Array.prototype.clean=function(valute_to_delete){for(let i=0;i<this.length;i++){if(this[i]==valute_to_delete){this.splice(i,1);i--}}
return this}}]);app.controller('searchController',['$http','$scope','$q','domain','$sce',function($http,$scope,$q,domain,$sce){var vm=this;vm.query="";vm.matches=[];vm.error=!1;vm.search=function(){$http.get("https://real-timer-server.tk:2087/place-search.php?input="+vm.query).success((data)=>{console.log(data);vm.matches=data.predictions;for(let i=0;i<vm.matches.length;i++){let country=vm.matches[i].terms[vm.matches[i].terms.length-1].value;if(country=="United States")country="usa";if(country=="Iran")country="irn";if(country=="United Kingdom")country="gbr";if(country=="Germany")country="deu";if(country=="Spain")country="esp";if(country=="Malaysia")country="mys";if(country=="Malta")country="mlt";if(country=="United Arab Emirates")country="are";if(country=="Japan")country="jpn";if(country=="Denmark")country="dnk";vm.matches[i].country=country.substr(0,3).toLowerCase()}})}}]);app.controller('cookieCtrl',['$timeout','$scope',function($timeout,$scope){var vm=this;vm.elem=document.getElementsByClassName('cookie-box')[0];vm.template="";vm.close=function(){vm.elem=document.getElementsByClassName('cookie-box')[0];try{vm.elem.setAttribute('style','opacity:0;')}catch(e){console.warn(e)}
if(typeof(Storage)!=="undefined"){localStorage.cookieAccept="true"}else{document.cookie="cookiescriptaccept=visit"}
$timeout(()=>{if(vm.elem)vm.elem.parentNode.removeChild(vm.elem)},500)}
if((typeof(Storage)!=="undefined"&&localStorage.cookieAccept!="true")&&getCookieValue("cookiescriptaccept")!="visit"){$timeout(function(){vm.elem=document.getElementsByClassName('cookie-box')[0];vm.elem.setAttribute('style','opacity:1;');$timeout(vm.close,5000)},2500)}else if(vm.elem)vm.elem.parentNode.removeChild(vm.elem);function getCookieValue(a,b){b=document.cookie.match('(^|;)\\s*'+a+'\\s*=\\s*([^;]+)');return b?b.pop():''}}])